C:\Users\vitor\repositorios\agente-ura\src\test>pytest --maxfail=1
=============================================================== test session starts ===============================================================
platform win32 -- Python 3.13.3, pytest-8.3.5, pluggy-1.5.0
rootdir: C:\Users\vitor\repositorios\agente-ura\src\test
plugins: anyio-4.9.0
collected 56 items

application\usecase\agente_use_case_test.py .....                                                                                            [  8%]
application\usecase\conversa_use_case_test.py .....                                                                                          [ 17%]
application\usecase\json_use_case_test.py .....                                                                                              [ 26%]
application\usecase\mensagem_use_case_test.py ....                                                                                           [ 33%]
entrypoint\controller\mapper\mensagem_mapper_test.py ........                                                                                [ 48%]
entrypoint\controller\mensagem_controller_test.py ....                                                                                       [ 55%]
entrypoint\controller\middleware\handler_middleware_test.py ......                                                                           [ 66%]
infrastructure\dataprovider\agente_data_provider_test.py ...F

==================================================================== FAILURES =====================================================================
___________________________________________________ test_enviar_mensagem_transformacao_success ____________________________________________________

stub_openai_client = <Mock id='2791726418976'>
agente = <src.infrastructure.dataprovider.agente_data_provider.AgenteDataProvider object at 0x00000289FFDFE650>

    def test_enviar_mensagem_transformacao_success(stub_openai_client, agente):
        historico = [{'role': 'assistant', 'content': 'ping'}]
        expected_json = '{"key":"value"}'
        stub_openai_client.chat.completions.create.return_value = DummyResponse(expected_json)

        result = agente.enviar_mensagem_trasformacao_json(historico)

>       stub_openai_client.chat.completions.create.assert_called_once_with(
            model='gt-p4', messages=historico, temperature=0
        )

infrastructure\dataprovider\agente_data_provider_test.py:62:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
..\..\..\..\AppData\Local\Programs\Python\Python313\Lib\unittest\mock.py:991: in assert_called_once_with
    return self.assert_called_with(*args, **kwargs)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <Mock name='mock.chat.completions.create' id='2791726416960'>, args = ()
kwargs = {'messages': [{'content': 'ping', 'role': 'assistant'}], 'model': 'gt-p4', 'temperature': 0}
expected = call(model='gt-p4', messages=[{'role': 'assistant', 'content': 'ping'}], temperature=0)
actual = call(model='gpt-4', messages=[{'role': 'assistant', 'content': 'ping'}], temperature=0)
_error_message = <function NonCallableMock.assert_called_with.<locals>._error_message at 0x00000289FFE5F1A0>, cause = None

    def assert_called_with(self, /, *args, **kwargs):
        """assert that the last call was made with the specified arguments.

        Raises an AssertionError if the args and keyword args passed in are
        different to the last call to the mock."""
        if self.call_args is None:
            expected = self._format_mock_call_signature(args, kwargs)
            actual = 'not called.'
            error_message = ('expected call not found.\nExpected: %s\n  Actual: %s'
                    % (expected, actual))
            raise AssertionError(error_message)

        def _error_message():
            msg = self._format_mock_failure_message(args, kwargs)
            return msg
        expected = self._call_matcher(_Call((args, kwargs), two=True))
        actual = self._call_matcher(self.call_args)
        if actual != expected:
            cause = expected if isinstance(expected, Exception) else None
>           raise AssertionError(_error_message()) from cause
E           AssertionError: expected call not found.
E           Expected: create(model='gt-p4', messages=[{'role': 'assistant', 'content': 'ping'}], temperature=0)
E             Actual: create(model='gpt-4', messages=[{'role': 'assistant', 'content': 'ping'}], temperature=0)

..\..\..\..\AppData\Local\Programs\Python\Python313\Lib\unittest\mock.py:979: AssertionError
================================================================ warnings summary =================================================================
..\..\..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\pydantic\_internal\_config.py:323
  C:\Users\vitor\AppData\Local\Programs\Python\Python313\Lib\site-packages\pydantic\_internal\_config.py:323: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
    warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
============================================================= short test summary info =============================================================
FAILED infrastructure/dataprovider/agente_data_provider_test.py::test_enviar_mensagem_transformacao_success - AssertionError: expected call not found.
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
==================================================== 1 failed, 40 passed, 1 warning in 25.37s =====================================================